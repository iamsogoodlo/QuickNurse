<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickNurse - Nurse Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-6">
    <h1 class="text-2xl font-bold mb-4">Nurse Dashboard</h1>
    <div id="stats" class="bg-white rounded-lg shadow p-4 mb-6 w-full max-w-md">
        <p class="mb-2">Monthly Revenue: <span id="monthly-revenue" class="font-semibold">$0</span></p>
        <p class="mb-2">Jobs Taken: <span id="monthly-jobs" class="font-semibold">0</span></p>
        <p>Rating: <span id="rating" class="font-semibold">0</span> / 5</p>
    </div>
    <div id="requests" class="space-y-4"></div>

    <script>
    const API_BASE_URL = window.API_BASE_URL || 'http://localhost:5000/api';
    let nurse = null;
    let token = null;

    document.addEventListener('DOMContentLoaded', () => {
        nurse = JSON.parse(localStorage.getItem('user') || '{}');
        token = localStorage.getItem('token');
        loadDashboard();
        setInterval(loadDashboard, 10000);
    });

    async function loadDashboard() {
        if (!nurse?.nurse_id) return;
        try {
            const res = await fetch(`${API_BASE_URL}/nurses/dashboard?nurse_id=${nurse.nurse_id}`, {
                headers: token ? { 'Authorization': `Bearer ${token}` } : {}
            });
            const data = await res.json();
            if (data.success) {
                const stats = data.data;
                document.getElementById('monthly-revenue').textContent = `$${stats.monthly_revenue.toFixed(2)}`;
                document.getElementById('monthly-jobs').textContent = stats.monthly_jobs;
                document.getElementById('rating').textContent = stats.average_rating.toFixed(1);
                updateRequests(stats.new_requests || []);
            }
        } catch (err) {
            console.error('Dashboard error', err);
        }
    }

    function updateRequests(requests) {
        const container = document.getElementById('requests');
        container.innerHTML = '';
        if (requests.length === 0) {
            container.innerHTML = '<p class="text-gray-500">No new job opportunities.</p>';
            return;
        }
        requests.forEach(req => {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg shadow p-4';
            div.innerHTML = `
                <h3 class="font-semibold text-teal-700 mb-2">${req.service_type}</h3>
                <p class="text-sm text-gray-600 mb-1">${req.patient_city_state} (~${req.approx_distance_miles} mi)</p>
                <p class="text-sm text-gray-600 mb-1">Earnings: $${req.estimated_earnings.toFixed(2)}</p>
                <button class="mt-2 bg-green-600 text-white px-4 py-1 rounded" onclick="alert('Accepting request ${req.request_id}')">Accept</button>
            `;
            container.appendChild(div);
        });
    }
    </script>
</body>
</html>
